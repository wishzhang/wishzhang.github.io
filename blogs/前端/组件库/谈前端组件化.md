---
title: 谈前端组件化
date: 2022-08-23
tags: 
- 前端工作手册

categories:

- 前端
showSponsor: true
---



前端开发工作最为基础和核心的是组件化，再配合自动化，是前端高效工作的方向。尽管前端工程提供了MVVM等框架，但架构、过程管理、组件化自动化都是很弱的，造成生产率很低，开发成本高软件质量却不好。



怎么开始做组件化呢？不同公司的场景是不同的，同一个公司的不同阶段也是不同的。自己公司自己开发基础组件库有没有必要？定制的UI设计效果如果比开源的好，那有发展需要的就可以自己去开发，只是99%的公司是还没达到那个层次和能力去搞。



通常的做法就是在项目直接引入第三方组件库，直接应用第三方组件库调整样式来实现业务功能，在项目内抽取公共的base组件、公共的业务组件。这在单个项目是合理的做法，**但在多个项目需要用到的情况下**，这些封装的公共组件要复用，有几种方式：

- 通过拷贝的方式
- 通过组件库类似npm link的方式
- 通过组件库的依赖包的方式



通过拷贝的方式，在项目数量少的时候，互相拷贝然后修改来达到复用。这种情况还会出现重复编写相同组件的情况（因为不知道或者组件和原项目耦合严重一时抽不出来）。这种方式从根本上没有做多项目的组件复用设计，导致该复用的组件很多没复用，而拷贝之后的代码同步也是个问题，这个组件的后续演化所做的工作最后还是各自的工作（如果是不同的人在各自的项目的情况），除非是一次性的拷贝后不再修改了。所以这种方式只是减少了少量重复的开发工作，并且项目的质量上限不高，在项目数量少，开发人员少，项目质量要求不高的情况能让项目维持下去。短期这样似乎开发效率高，但其实长期来说开发成本是不断上升的，本来不必要的或者重复的工作越来越多。



 通过组件库类似link的方式，这种方式开始有对多人多项目的组件复用问题的解决，包括识别公共组件，在组件库统一管理组件，项目通过npm link的方式连接的是组件库的最新版本。初步解决了多人多项目的组件复用问题，总体比上面的方案要好一些，但还是只是短期来说是解决了。长期来看。。。发现核心不是npm link这方式的问题，而是版本的问题！意味项目版本只对应了组件库的一个版本，也就是说：

1. 要求项目要不断适应组件库的更新，强制更新的问题（造成意外的非稳定性和开发维护成本）
2. 项目本身的代码版本管理并不完整了

对于第一点，这种方式一般在开发上是有强制性的保持更新，因为比如在一个新环境上运行就要重新link，这样本身失去了一定的项目稳定性。

对于第二点在一般的开发好像不是必须的，不过没有完整的代码版本功能也会造成一些麻烦，比如回退版本。



所以这种方式，没解决多项目与组件库功能变更方面的解耦问题，强制在本地更新（但在线上是不能这样搞的有破坏性变更风险）。这个好像还说的过去，但约束了更新的问题，造成了一定的稳定性降低的问题，约束了线上ci流程。这几个问题会随着项目与组件库的差异变化而变严重（也就是长期的维护问题），比如项目很久没更新了也比较稳定了也应该保持稳定的，而组件库却一直在频繁的迭代，就导致差异太大要更新维护的成本就变大很多了，这个维护问题还是有些严重的，意味着依赖这种方式的项目的维护成本比较大，不符合项目保持长期的稳定性的质量需求。



上面说明的主要影响相对长期的开发维护成本和软件稳定性的问题。从时间长度、质量需求方面考虑吧，总之没有版本解耦，但随着组件库粒度变大（比如单包组件库）并且迭代频率变大项目变多而造成项目的质量降低。最后从架构方面说一下，这两种方式一般在所在的环境都能维持比较长的一段时间活下去。第一种方式要比第二种方式的项目要稳定一些，自由度更高，**长期看来第二种不如第一种方式，第一种方式至少不耦合，不添加额外约束，不强制更新**（第一种方式通过管理文件夹拷贝而不要求强制更新。而第二种方式实质是用纯粹的代码耦合来达到复用而牵一发动全部依赖的项目，毕竟项目要迭代就必须强制更新。从这个角度看其实相当于是把公共代码放到组件库而已，这类似把这些项目和组件库分开文件夹放到一起，然后在本地开发环境隐性影响，还好不是直接影响线上生产环境）



但为什么不用第三种方式呢，可能主要是第三种方式对技术和环境有一定的门槛，而上面的方式一般在所在环境搞个三五年也勉强能行，所以就不必使用第三种方式了。



第三种方式就是使用平时的组件库依赖包的方式。但在实际的应用中会有一些问题，导致组件库的落地效果并不理想。第三种方式其实也调整了开发模式，组件库的开发维护需要有特定的角色和流程。比如：

- 识别出业务需求的公共组件
- 在组件库文档查找对应的组件
  - 有，则使用已有组件库的对应组件
  - 没有，则考虑要不要在组件库开发这个组件
- 组件库开发人员收到组件需求，评估需求
- 设计实现组件
- 测试组件
- 编写组件文档，线上更新
- 通知组件版本订阅更新



来看下建立组件库核心的几个方面：

- 决定采用单包还是多包的架构
- 组件库的构建
- 组件库的对外文档



决定采用单包还是多包的架构。基础组件库几乎采用的是单包的方式，基础组件库是对基础的UI、界面交互方式的实现，从需求上来说对一致性要求比较高，单包能保证一致性，把这些组件都单独发包就保证不了了（其实一致性也是一种强依赖）。如果业务组件之间依赖少的话，使用多包的方式，适合单独发布更新。多包方式的打包出来要求互不影响，而如果之间依赖多的话，需要更新相关的引用这就不大合适。









